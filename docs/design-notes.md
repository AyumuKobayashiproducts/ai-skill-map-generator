# 設計メモ・今後の改善アイデア

実装の裏側で「何を考えてこの構成にしているか」をまとめた、開発者 / 面接向けのノートです。  
README や機能仕様書では書ききれない設計意図や、今後の改善の方向性を補足します。

## 現状の設計で意識したこと

- ユーザーストーリー:
  - 「3分で自分の今と次がわかる」ことをゴールに、画面構成やタブの順番を決めています。
  - ホーム → 結果（概要） → キャリア & 求人 → 面接練習 → エクスポート、という流れを想定。

- API 設計:
  - すべて JSON ベース & Zod スキーマで定義し、Next.js Route Handler に集約。
  - フロントエンドからの呼び出しは `lib/apiClient.ts` の `postJson` に統一。

- ロジック分離:
  - 転職準備スコアのようなビジネスロジックは `lib/readiness.ts` の純粋関数として実装。
  - 回答品質評価は `lib/answerEvaluator.ts` で文字数・具体性・構造・STAR要素をルールベース評価。
  - Supabase アクセスは `lib/supabaseClient.ts` / `lib/skillMapLoader.ts` に集約。

- 品質・運用:
  - Vitest によるユニットテスト + Playwright による簡易 E2E テスト。
  - GitHub Actions（`.github/workflows/ci.yml`）で `npm run build` と `npm run test` を自動実行。
  - `usage_logs` による機能ごとの利用ログと `/admin/usage` での可視化。

---

## 転職面接練習機能の設計意図

### なぜこの機能を作ったか

転職活動において「面接準備」は最も不安を感じやすいフェーズです。特にエンジニアは：

- 自分の技術経験を言語化するのが苦手
- STAR法などの面接テクニックを知っていても実践で使えない
- 練習相手がいない / フィードバックをもらう機会がない

という課題を抱えています。この機能は、スキルマップの分析結果と連携することで「あなたの強み・弱みに合わせたパーソナライズされた面接練習」を可能にしています。

### 技術的な設計ポイント

1. **ルールベース評価 + AI評価のハイブリッド**
   - 文字数、数字の有無、STAR要素の検出はルールベース（`lib/answerEvaluator.ts`）で高速に判定
   - その結果をAIのプロンプトに含めることで、より的確なフィードバックを生成
   - 利点：AIだけに依存しない説明可能な評価 + AIの柔軟性を両立

2. **面接タイプ別のプロンプト最適化**
   - 一般面接：簡潔さ・一貫性・熱意を重視
   - 技術面接：技術的深さ・問題解決プロセス・ビジネスインパクトを重視
   - 行動面接：STAR法の4要素（状況・課題・行動・結果）を重視

3. **セッション管理とデータ永続化**
   - `interview_sessions` テーブルに練習履歴を保存
   - 過去のスコアとの比較で成長を可視化
   - セッション終了時の総評でネクストアクションを明確化

4. **UX設計**
   - 初回ユーザー向けのオンボーディングガイド
   - 質問ごとのヒントカード（面接タイプに応じたSTAR法の解説など）
   - プログレスバーによる進捗の可視化

### 評価ロジックの詳細（`lib/answerEvaluator.ts`）

| 評価項目 | 評価方法 | 重み（行動面接） | 重み（技術面接） | 重み（一般面接） |
|---------|---------|----------------|----------------|----------------|
| 文字数 | 面接タイプ別の理想範囲と比較 | 15% | 20% | 25% |
| 具体性 | 数字、「例えば」などのパターン検出 | 25% | 35% | 30% |
| 構造 | 「まず」「次に」「結果として」などの検出 | 20% | 25% | 25% |
| STAR要素 | 状況/課題/行動/結果の4要素検出 | 40% | 20% | 20% |

### アクセシビリティ対応

- タップターゲットサイズの確保（最小44px）
- aria-label / aria-describedby の適切な設定
- キーボードナビゲーション対応
- prefers-reduced-motion 対応（アニメーション無効化）
- prefers-contrast: high 対応（ハイコントラストモード）

## 今後の改善候補（技術）

- OpenAI Responses API への完全移行とプロンプトの整理
- SkillMap のバージョニング（同一ユーザーの長期的な成長曲線を比較できるようにする）
- RLS ポリシーの細かいチューニングと、本番運用レベルでの検証
- コンポーネント分割と Storybook 導入による UI カタログ化（余力があれば）
- 面接練習のストリーミング対応（フィードバック生成中のUX改善）

## 今後の改善候補（プロダクト）

- 企業側アカウントを想定した「候補者スキルマップ一覧」ビュー
- チームリーダー / メンター向けに、メンバーの成長を俯瞰できるダッシュボード
- Findy など他サービスとの連携を見据えたスキーマ設計の再整理

## 面接練習機能の発展アイデア

### 短期（1-2週間で実装可能）

1. **逆質問練習モード**
   - 「最後に何か質問はありますか？」に対する練習
   - 企業研究と連動した質問生成

2. **音声入力対応**
   - Web Speech API を使った音声入力
   - 実際の面接に近い練習体験

3. **レポート機能**
   - 練習履歴をPDF/Markdownでエクスポート
   - 転職エージェントへの共有用

### 中期（1-2ヶ月）

1. **企業別の質問テンプレート**
   - 「Google風」「スタートアップ風」などのプリセット
   - コンピテンシーモデルに基づいた質問生成

2. **模擬面接モード**
   - 30分の面接セッションをシミュレート
   - 導入→深掘り→逆質問の流れを体験

3. **ピアレビュー機能**
   - 他のユーザーの回答を匿名で評価
   - 優秀な回答例のギャラリー

### 長期（将来構想）

1. **AI面接官のパーソナリティ設定**
   - 「圧迫面接タイプ」「フレンドリータイプ」など
   - 面接官の性格に応じた質問スタイルの変化

2. **動画面接対策**
   - カメラを使った表情分析
   - アイコンタクト、姿勢などの非言語フィードバック

3. **企業マッチング連携**
   - 練習履歴と企業の求める人物像をマッチング
   - 「この企業の面接に向けた重点練習」の提案

## 面接・ポートフォリオでの使い方メモ

- GitHub の README と合わせて、`docs/` 以下のファイルを「設計・仕様をどこまで言語化しているか」の補足資料として見せる想定です。
- `/about` 画面とセットで、このドキュメントを参照しながら設計の意図や今後の改善方針を説明できます。


